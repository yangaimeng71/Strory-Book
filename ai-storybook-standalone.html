<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ğŸ¨ AIç»˜æœ¬ - å„¿ç«¥æ•…äº‹ç”Ÿæˆå™¨</title>
    <meta name="description" content="ä¸º3-8å²å„¿ç«¥è®¾è®¡çš„AIç»˜æœ¬åˆ›ä½œå·¥å…·ï¼Œæ”¯æŒæ•…äº‹ç”Ÿæˆã€æ’ç”»é…å›¾å’Œè¯­éŸ³æœ—è¯»">
    <meta name="keywords" content="AIç»˜æœ¬,å„¿ç«¥æ•…äº‹,è¯­éŸ³æœ—è¯»,ç§»åŠ¨ç«¯,æ•™è‚²">
    
    <!-- æ·»åŠ PWAæ”¯æŒ -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQUnnu5jmnKwiLCJzaG9ydF9uYW1lIjoiQUnnu5jmnKwiLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJ0aGVtZV9jb2xvciI6IiM2NjdlZWEiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2ZmZmZmZiIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSFpwWlhkQ2IzZzlJakFnTUNBNU5pQTVOaUlnZG1WeWMybHZiajBpTVM0eElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTVoY21jdk1qQXdNQzl6ZG1jaVBnbzhZMmx5WTJ4bElHTjRQU0kwT0NJZ1kza1BTSDBPV0NJZ2NqMGlNemt1TmlJZ1ptbHNiRDBpSXpZMk4yVmxZU0lnTHo0OGRHVjRkQ0I0UFNJek5pSWdlVDBpTlRRaUlHWnZiblF0Wm1GdGFXeDVQU0pCY21saGJDSWdabTl1ZEMxemFYcGxQU0l6TUhCNElpQm1hV3hzUFNJalptWm1JaUErOEFvZ1FVa080NGEvYStlN21PZStpVGdnUEM5MFpYaDBQZzhMM04yWnoiLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    
    <style>
        /* åŸºç¡€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
            line-height: 1.6;
        }

        /* é¡µé¢å®¹å™¨ */
        .page {
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
            opacity: 0;
            animation: fadeIn 0.5s ease-in-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* é¦–é¡µæ ·å¼ */
        #homePage {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .header {
            margin-bottom: 40px;
            position: relative;
        }

        .settings-btn {
            position: absolute;
            top: -10px;
            right: 0;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            animation: pulse 3s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .settings-btn:hover, .settings-btn:active {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg) scale(1.1);
        }

        .logo {
            font-size: 2.8rem;
            color: #fff;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            margin-bottom: 15px;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .subtitle {
            color: #fff;
            font-size: 1.1rem;
            opacity: 0.95;
            font-weight: 300;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .input-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            padding: 35px 30px;
            margin-bottom: 30px;
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(15px);
            transform: translateY(0);
            transition: all 0.3s ease;
        }

        .input-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.2);
        }

        .input-section h2 {
            color: #5a67d8;
            margin-bottom: 25px;
            font-size: 1.4rem;
            font-weight: 600;
        }

        #storyInput {
            width: 100%;
            padding: 18px 24px;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            font-size: 1.05rem;
            margin-bottom: 25px;
            background: #fff;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        #storyInput:focus {
            outline: none;
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.25);
        }

        .primary-btn {
            width: 100%;
            padding: 18px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 1.15rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
            font-family: inherit;
        }

        .primary-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .primary-btn:hover:before {
            left: 100%;
        }

        .primary-btn:hover, .primary-btn:active {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
        }

        .preset-themes {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            padding: 30px;
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(15px);
        }

        .preset-themes h3 {
            color: #5a67d8;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .theme-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .theme-tag {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #fff;
            padding: 12px 18px;
            border-radius: 28px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .theme-tag:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .theme-tag:hover:before {
            left: 100%;
        }

        .theme-tag:hover, .theme-tag:active {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 154, 158, 0.4);
        }

        /* åŠ è½½é¡µæ ·å¼ */
        #loadingPage {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .loading-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            padding: 45px 35px;
            box-shadow: 0 18px 50px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(15px);
            max-width: 400px;
            width: 100%;
        }

        .magic-wand {
            font-size: 3.5rem;
            animation: sparkle 2s ease-in-out infinite;
            margin-bottom: 25px;
            position: relative;
        }

        .magic-wand:after {
            content: 'âœ¨';
            position: absolute;
            top: -10px;
            right: -15px;
            font-size: 1.5rem;
            animation: twinkle 1.5s ease-in-out infinite alternate;
        }

        @keyframes sparkle {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(12deg) scale(1.1); }
            75% { transform: rotate(-12deg) scale(1.1); }
        }

        @keyframes twinkle {
            0% { opacity: 0.5; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1.2); }
        }

        .loading-text {
            font-size: 1.3rem;
            color: #5a67d8;
            font-weight: 600;
            margin-bottom: 25px;
        }

        .loading-steps {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .step {
            padding: 14px 22px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            color: #5a67d8;
            font-weight: 600;
            opacity: 0.6;
            transition: all 0.4s ease;
            border-left: 4px solid transparent;
        }

        .step.active {
            opacity: 1;
            background: rgba(102, 126, 234, 0.2);
            transform: translateX(8px);
            border-left-color: #667eea;
        }

        /* æ•…äº‹é˜…è¯»é¡µæ ·å¼ */
        #storyPage {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 0;
        }

        .story-header {
            background: rgba(255, 255, 255, 0.95);
            padding: 18px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .icon-btn {
            background: rgba(90, 103, 216, 0.1);
            border: none;
            font-size: 1.8rem;
            color: #5a67d8;
            cursor: pointer;
            padding: 10px;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .icon-btn:hover, .icon-btn:active {
            background: rgba(90, 103, 216, 0.2);
            transform: scale(1.1);
        }

        #storyTitle {
            font-size: 1.3rem;
            color: #5a67d8;
            font-weight: 700;
            text-align: center;
            flex: 1;
            margin: 0 20px;
        }

        .page-indicator {
            font-size: 1rem;
            color: #667eea;
            font-weight: 600;
            background: rgba(102, 126, 234, 0.1);
            padding: 8px 12px;
            border-radius: 20px;
        }

        .story-content {
            flex: 1;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .story-image {
            position: relative;
            width: 100%;
            max-width: 420px;
            margin: 0 auto;
            aspect-ratio: 4/3;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 45px rgba(0, 0, 0, 0.2);
            background: linear-gradient(45deg, #f0f2f5 25%, #e2e8f0 50%, #f0f2f5 75%);
            background-size: 400% 400%;
            animation: shimmer 2s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .story-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 20px;
            transition: all 0.5s ease-in-out;
        }

        .image-loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 18px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .spinner {
            width: 45px;
            height: 45px;
            border: 4px solid rgba(102, 126, 234, 0.2);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .image-loading p {
            color: #667eea;
            font-weight: 600;
            font-size: 1rem;
        }

        .story-text {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px 25px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(15px);
        }

        #storyParagraph {
            font-size: 1.15rem;
            line-height: 1.9;
            color: #4a5568;
            text-align: justify;
            font-weight: 400;
        }

        .highlight {
            background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
            padding: 3px 6px;
            border-radius: 6px;
            animation: glow 1s ease-in-out infinite alternate;
            position: relative;
            box-shadow: 0 2px 8px rgba(168, 237, 234, 0.4);
        }

        @keyframes glow {
            0% { opacity: 0.8; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.02); }
        }

        .control-bar {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 18px;
            box-shadow: 0 -8px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
        }

        .nav-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 14px;
            padding: 14px 18px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            min-width: 85px;
            position: relative;
            overflow: hidden;
            font-family: inherit;
        }

        .nav-btn:disabled {
            background: #e2e8f0;
            color: #a0aec0;
            cursor: not-allowed;
        }

        .nav-btn:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 18px;
            flex: 1;
            justify-content: center;
        }

        .play-btn {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 55px;
            height: 55px;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 20px rgba(255, 154, 158, 0.3);
        }

        .play-btn:hover, .play-btn:active {
            transform: scale(1.15);
            box-shadow: 0 8px 30px rgba(255, 154, 158, 0.5);
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
            color: #5a67d8;
            font-weight: 600;
        }

        #speedSelect {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 8px 12px;
            font-size: 0.85rem;
            background: white;
            color: #4a5568;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #speedSelect:focus {
            outline: none;
            border-color: #667eea;
        }

        /* ç»“æŸé¡µæ ·å¼ */
        #endPage {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .end-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            padding: 45px 35px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(20px);
            max-width: 420px;
            width: 100%;
        }

        .celebration {
            font-size: 4.5rem;
            animation: bounce 2s ease-in-out infinite;
            margin-bottom: 25px;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-25px); }
            60% { transform: translateY(-12px); }
        }

        .end-container h2 {
            color: #5a67d8;
            font-size: 1.6rem;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .end-container p {
            color: #667eea;
            font-size: 1.05rem;
            margin-bottom: 35px;
            opacity: 0.9;
            font-weight: 500;
        }

        .end-actions {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .secondary-btn {
            background: rgba(102, 126, 234, 0.1);
            color: #5a67d8;
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 14px;
            padding: 14px 24px;
            font-size: 1.05rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-weight: 600;
            font-family: inherit;
        }

        .secondary-btn:hover, .secondary-btn:active {
            background: rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
        }

        /* Toastæç¤º */
        .toast {
            position: fixed;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 14px 24px;
            border-radius: 30px;
            font-size: 0.95rem;
            z-index: 1001;
            opacity: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-weight: 600;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(15px);
        }

        /* éšè—å…¶ä»–é¡µé¢ */
        .page:not(#homePage) {
            display: none;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 480px) {
            .page { padding: 18px; }
            .logo { font-size: 2.3rem; }
            .input-section { padding: 28px 22px; }
            .preset-themes { padding: 25px; }
            .story-content { padding: 18px; }
            .control-bar { padding: 20px; gap: 15px; }
            .nav-btn { padding: 12px 15px; font-size: 0.85rem; min-width: 75px; }
            .play-btn { width: 50px; height: 50px; font-size: 1.1rem; }
            .audio-controls { gap: 15px; }
        }

        @media (max-width: 360px) {
            .theme-tags { gap: 10px; }
            .theme-tag { padding: 10px 14px; font-size: 0.85rem; }
            .control-bar { 
                flex-direction: column; 
                gap: 18px; 
                padding: 18px;
            }
            .nav-btn { 
                width: 100%; 
                justify-content: center;
                min-width: unset;
            }
            .audio-controls {
                width: 100%;
                justify-content: center;
            }
        }

        /* å¹³æ¿æ¨ªå±ä¼˜åŒ– */
        @media (min-width: 768px) and (orientation: landscape) {
            .story-content {
                flex-direction: row;
                align-items: flex-start;
                gap: 35px;
            }
            
            .story-image {
                flex: 1;
                max-width: none;
            }
            
            .story-text {
                flex: 1;
            }
        }

        /* å¤§å±å¹•ä¼˜åŒ– */
        @media (min-width: 1024px) {
            .page {
                max-width: 650px;
                margin: 0 auto;
            }
            
            body {
                display: flex;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
            }
        }

        /* æ·±è‰²ä¸»é¢˜æ”¯æŒ */
        @media (prefers-color-scheme: dark) {
            .input-section,
            .preset-themes,
            .loading-container,
            .story-text,
            .control-bar,
            .end-container {
                background: rgba(45, 55, 72, 0.95);
                color: #e2e8f0;
            }
            
            .input-section h2,
            .preset-themes h3,
            .loading-text,
            #storyTitle,
            .end-container h2 {
                color: #90cdf4;
            }
            
            #storyInput,
            #speedSelect {
                background: rgba(26, 32, 44, 0.8);
                color: #e2e8f0;
                border-color: #4a5568;
            }
        }

        /* æ‰“å°æ ·å¼ */
        @media print {
            body {
                background: white;
                color: black;
            }
            
            .page {
                background: white !important;
                box-shadow: none;
            }
            
            .control-bar,
            .settings-btn {
                display: none;
            }
        }

        /* é«˜å¯¹æ¯”åº¦æ¨¡å¼ */
        @media (prefers-contrast: high) {
            .primary-btn,
            .nav-btn {
                background: #000;
                border: 2px solid #fff;
            }
            
            .theme-tag {
                background: #000;
                border: 2px solid #fff;
            }
        }
    </style>
</head>
<body>
    <!-- é¦–é¡µ -->
    <div class="page" id="homePage">
        <div class="header">
            <button id="settingsBtn" class="settings-btn" title="è®¾ç½®">âš™ï¸</button>
            <h1 class="logo">ğŸ¨ AIç»˜æœ¬</h1>
            <p class="subtitle">ä¸ºå­©å­åˆ›é€ æ— é™æƒ³è±¡çš„æ•…äº‹ä¸–ç•Œ</p>
        </div>
        
        <div class="input-section">
            <h2>å‘Šè¯‰æˆ‘ä½ æƒ³å¬ä»€ä¹ˆæ•…äº‹ï¼Ÿ</h2>
            <input type="text" id="storyInput" placeholder="ä¾‹å¦‚ï¼šå‹‡æ•¢çš„å°å…”å­" maxlength="50" autocomplete="off">
            <button id="generateBtn" class="primary-btn" title="å¼€å§‹åˆ›ä½œæ•…äº‹">
                âœ¨ å¼€å§‹åˆ›ä½œæ•…äº‹
            </button>
        </div>
        
        <div class="preset-themes">
            <h3>æˆ–è€…é€‰æ‹©ä¸€ä¸ªä¸»é¢˜ï¼š</h3>
            <div class="theme-tags">
                <span class="theme-tag" data-theme="å‹‡æ•¢çš„å°åŠ¨ç‰©" title="ç‚¹å‡»é€‰æ‹©">ğŸ° å‹‡æ•¢å°åŠ¨ç‰©</span>
                <span class="theme-tag" data-theme="ç¥å¥‡çš„æ£®æ—" title="ç‚¹å‡»é€‰æ‹©">ğŸŒ² ç¥å¥‡æ£®æ—</span>
                <span class="theme-tag" data-theme="å‹è°Šçš„åŠ›é‡" title="ç‚¹å‡»é€‰æ‹©">ğŸ‘« å‹è°Šæ•…äº‹</span>
                <span class="theme-tag" data-theme="å¥‡å¦™çš„æµ·åº•ä¸–ç•Œ" title="ç‚¹å‡»é€‰æ‹©">ğŸ  æµ·åº•ä¸–ç•Œ</span>
                <span class="theme-tag" data-theme="å¤ªç©ºå¤§å†’é™©" title="ç‚¹å‡»é€‰æ‹©">ğŸš€ å¤ªç©ºå†’é™©</span>
                <span class="theme-tag" data-theme="å–„è‰¯çš„å°å…¬ä¸»" title="ç‚¹å‡»é€‰æ‹©">ğŸ‘¸ ç«¥è¯å…¬ä¸»</span>
            </div>
        </div>
    </div>
    
    <!-- åŠ è½½é¡µ -->
    <div class="page" id="loadingPage">
        <div class="loading-container">
            <div class="magic-wand" role="img" aria-label="é­”æ³•æ£’">âœ¨</div>
            <div class="loading-text">AIæ­£åœ¨ä¸ºä½ åˆ›ä½œæ•…äº‹...</div>
            <div class="loading-steps">
                <div class="step" id="step1">ğŸ“ æ„æ€æ•…äº‹æƒ…èŠ‚</div>
                <div class="step" id="step2">ğŸ¨ ç»˜åˆ¶ç²¾ç¾æ’ç”»</div>
                <div class="step" id="step3">ğŸµ å‡†å¤‡è¯­éŸ³æœ—è¯»</div>
            </div>
        </div>
    </div>
    
    <!-- æ•…äº‹é˜…è¯»é¡µ -->
    <div class="page" id="storyPage">
        <div class="story-header">
            <button id="backBtn" class="icon-btn" title="è¿”å›é¦–é¡µ" aria-label="è¿”å›é¦–é¡µ">â†</button>
            <h2 id="storyTitle">æ•…äº‹æ ‡é¢˜</h2>
            <div class="page-indicator" role="status" aria-live="polite">
                <span id="currentPage">1</span> / <span id="totalPages">1</span>
            </div>
        </div>
        
        <div class="story-content">
            <div class="story-image">
                <img id="storyImg" src="" alt="æ•…äº‹æ’ç”»" style="display: none;">
                <div class="image-loading" id="imageLoading" role="status" aria-live="polite">
                    <div class="spinner" aria-label="åŠ è½½ä¸­"></div>
                    <p>æ­£åœ¨ç»˜åˆ¶æ’ç”»...</p>
                </div>
            </div>
            
            <div class="story-text">
                <p id="storyParagraph" role="main"></p>
            </div>
        </div>
        
        <div class="control-bar" role="toolbar" aria-label="æ•…äº‹æ§åˆ¶">
            <button id="prevBtn" class="nav-btn" disabled title="ä¸Šä¸€é¡µ" aria-label="ä¸Šä¸€é¡µ">
                â† ä¸Šä¸€é¡µ
            </button>
            
            <div class="audio-controls">
                <button id="playBtn" class="play-btn" title="æ’­æ”¾/æš‚åœ" aria-label="æ’­æ”¾æœ—è¯»">â–¶ï¸</button>
                <div class="speed-control">
                    <label for="speedSelect">è¯­é€Ÿ:</label>
                    <select id="speedSelect" title="é€‰æ‹©æœ—è¯»è¯­é€Ÿ">
                        <option value="0.8">æ…¢</option>
                        <option value="1.0" selected>æ­£å¸¸</option>
                        <option value="1.2">å¿«</option>
                    </select>
                </div>
            </div>
            
            <button id="nextBtn" class="nav-btn" title="ä¸‹ä¸€é¡µ" aria-label="ä¸‹ä¸€é¡µ">
                ä¸‹ä¸€é¡µ â†’
            </button>
        </div>
    </div>
    
    <!-- ç»“æŸé¡µ -->
    <div class="page" id="endPage">
        <div class="end-container">
            <div class="celebration" role="img" aria-label="åº†ç¥">ğŸ‰</div>
            <h2>æ•…äº‹ç»“æŸå•¦ï¼</h2>
            <p>å¸Œæœ›ä½ å–œæ¬¢è¿™ä¸ªç¾å¦™çš„æ•…äº‹ï½</p>
            
            <div class="end-actions">
                <button id="newStoryBtn" class="primary-btn" title="åˆ›ä½œæ–°æ•…äº‹">
                    âœ¨ å†æ¥ä¸€ä¸ªæ•…äº‹
                </button>
                <button id="saveStoryBtn" class="secondary-btn" title="ä¿å­˜åˆ°æœ¬åœ°">
                    ğŸ“– ä¿å­˜æ•…äº‹
                </button>
                <button id="shareStoryBtn" class="secondary-btn" title="åˆ†äº«ç»™æœ‹å‹">
                    ğŸ“¤ åˆ†äº«ç»˜æœ¬
                </button>
            </div>
        </div>
    </div>

    <!-- Toastæç¤º -->
    <div id="toast" class="toast" role="alert" aria-live="assertive"></div>
    
    <script>
        'use strict';

        // AIç»˜æœ¬åº”ç”¨ä¸»ç±»
        class StoryApp {
            constructor() {
                this.currentStory = null;
                this.currentPageIndex = 0;
                this.isPlaying = false;
                this.speechSynthesis = window.speechSynthesis;
                this.currentUtterance = null;
                this.highlightTimeout = null;
                this.loadingInterval = null;
                
                this.init();
            }

            init() {
                console.log('ğŸ¨ AIç»˜æœ¬åº”ç”¨å¯åŠ¨ v2.0');
                try {
                    this.bindEvents();
                    this.showPage('homePage');
                    this.showToast('âœ¨ æ¬¢è¿ä½¿ç”¨AIç»˜æœ¬ï¼ç‚¹å‡»ä¸»é¢˜å¼€å§‹åˆ›ä½œ');
                    this.preloadVoices();
                } catch (error) {
                    console.error('âŒ åº”ç”¨åˆå§‹åŒ–å¤±è´¥:', error);
                    this.showToast('åº”ç”¨åŠ è½½å‡ºé”™ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
                }
            }

            preloadVoices() {
                // é¢„åŠ è½½è¯­éŸ³åˆæˆå™¨
                if (this.speechSynthesis) {
                    this.speechSynthesis.getVoices();
                    this.speechSynthesis.onvoiceschanged = () => {
                        console.log('ğŸµ è¯­éŸ³åº“åŠ è½½å®Œæˆ');
                    };
                }
            }

            bindEvents() {
                // é¦–é¡µäº‹ä»¶
                const generateBtn = document.getElementById('generateBtn');
                const storyInput = document.getElementById('storyInput');
                
                if (generateBtn) {
                    generateBtn.addEventListener('click', () => this.generateStory());
                }

                if (storyInput) {
                    storyInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.generateStory();
                        }
                    });

                    // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
                    storyInput.addEventListener('focus', () => {
                        storyInput.select();
                    });
                }

                // ä¸»é¢˜æ ‡ç­¾ç‚¹å‡»
                document.querySelectorAll('.theme-tag').forEach(tag => {
                    tag.addEventListener('click', () => {
                        const theme = tag.dataset.theme;
                        if (storyInput) storyInput.value = theme;
                        this.generateStory();
                    });
                });

                // æ•…äº‹é¡µé¢äº‹ä»¶
                const backBtn = document.getElementById('backBtn');
                if (backBtn) {
                    backBtn.addEventListener('click', () => this.goHome());
                }

                const prevBtn = document.getElementById('prevBtn');
                if (prevBtn) {
                    prevBtn.addEventListener('click', () => this.previousPage());
                }

                const nextBtn = document.getElementById('nextBtn');
                if (nextBtn) {
                    nextBtn.addEventListener('click', () => this.nextPage());
                }

                const playBtn = document.getElementById('playBtn');
                if (playBtn) {
                    playBtn.addEventListener('click', () => this.togglePlayback());
                }

                const speedSelect = document.getElementById('speedSelect');
                if (speedSelect) {
                    speedSelect.addEventListener('change', () => this.stopPlayback());
                }

                // ç»“æŸé¡µé¢äº‹ä»¶
                const newStoryBtn = document.getElementById('newStoryBtn');
                if (newStoryBtn) {
                    newStoryBtn.addEventListener('click', () => this.goHome());
                }

                const saveStoryBtn = document.getElementById('saveStoryBtn');
                if (saveStoryBtn) {
                    saveStoryBtn.addEventListener('click', () => this.saveStory());
                }

                const shareStoryBtn = document.getElementById('shareStoryBtn');
                if (shareStoryBtn) {
                    shareStoryBtn.addEventListener('click', () => this.shareStory());
                }

                // è®¾ç½®æŒ‰é’®
                const settingsBtn = document.getElementById('settingsBtn');
                if (settingsBtn) {
                    settingsBtn.addEventListener('click', () => {
                        this.showToast('ğŸ’¡ æç¤ºï¼šä½¿ç”¨ä¸åŒä¸»é¢˜è¯å¯ä»¥ç”Ÿæˆä¸åŒç±»å‹çš„æ•…äº‹');
                    });
                }

                // é”®ç›˜å¿«æ·é”®
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.stopPlayback();
                    }
                });

                console.log('âœ… æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨å·²ç»‘å®š');
            }

            async generateStory() {
                const storyInput = document.getElementById('storyInput');
                const input = storyInput ? storyInput.value.trim() : '';
                
                if (!input) {
                    this.showToast('â— è¯·è¾“å…¥æ•…äº‹ä¸»é¢˜æˆ–é€‰æ‹©ä¸€ä¸ªé¢„è®¾ä¸»é¢˜');
                    if (storyInput) storyInput.focus();
                    return;
                }

                console.log('ğŸš€ å¼€å§‹ç”Ÿæˆæ•…äº‹:', input);
                this.showPage('loadingPage');
                this.animateLoadingSteps();

                try {
                    // ç”Ÿæˆæ•…äº‹å†…å®¹
                    const story = await this.createStory(input);
                    this.currentStory = story;
                    this.currentPageIndex = 0;

                    // ç”Ÿæˆæ’ç”»
                    await this.generateImages(story);

                    this.showStoryPage();
                    console.log('âœ¨ æ•…äº‹ç”Ÿæˆå®Œæˆ:', story.title);
                    this.showToast('ğŸ‰ æ•…äº‹åˆ›ä½œå®Œæˆï¼å¯ä»¥å¼€å§‹é˜…è¯»äº†');
                } catch (error) {
                    console.error('âŒ ç”Ÿæˆæ•…äº‹å¤±è´¥:', error);
                    this.showToast('ğŸ˜” æ•…äº‹ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•');
                    this.showPage('homePage');
                }
            }

            async createStory(theme) {
                // é¢„å®šä¹‰æ•…äº‹æ¨¡æ¿
                const storyTemplates = {
                    'å‹‡æ•¢çš„å°åŠ¨ç‰©': {
                        title: 'å‹‡æ•¢çš„å°å…”å­è´è´',
                        paragraphs: [
                            'åœ¨ä¸€ç‰‡ç¾ä¸½çš„æ£®æ—é‡Œï¼Œä½ç€ä¸€åªåå«è´è´çš„å°å…”å­ã€‚è´è´æœ‰ç€é›ªç™½çš„æ¯›å‘å’Œçº¢å®çŸ³èˆ¬çš„çœ¼ç›ï¼Œä½†å¥¹æ€»æ˜¯å¾ˆèƒ†å°ï¼Œä¸æ•¢ç‹¬è‡ªå‡ºé—¨æ¢é™©ã€‚æ¯å½“å…¶ä»–å°åŠ¨ç‰©é‚€è¯·å¥¹ä¸€èµ·ç©è€æ—¶ï¼Œè´è´æ€»æ˜¯æ‘‡æ‘‡å¤´ï¼Œèº²åœ¨å¦ˆå¦ˆèº«åã€‚',
                            'ä¸€å¤©ï¼Œæ£®æ—é‡Œä¼ æ¥äº†æ€¥ä¿ƒçš„æ±‚æ•‘å£°ã€‚åŸæ¥æ˜¯å°æ¾é¼ å¥‡å¥‡åœ¨é‡‡æ¾æœæ—¶ä¸å°å¿ƒæ‰è¿›äº†æ·±æ·±çš„å±±æ´é‡Œï¼Œå¤§å®¶éƒ½å›´åœ¨æ´å£å´ä¸çŸ¥é“è¯¥æ€ä¹ˆåŠã€‚åŠ¨ç‰©ä»¬ç„¦æ€¥åœ°è®¨è®ºç€æ•‘æ´æ–¹æ¡ˆï¼Œä½†æ´å£å¤ªå°å¤ªæ·±ï¼Œå¤§å®¶éƒ½è¿›ä¸å»ã€‚',
                            'è´è´çœ‹åˆ°å¤§å®¶éƒ½å¾ˆç€æ€¥ï¼Œå¿ƒé‡Œä¹Ÿå¾ˆéš¾è¿‡ã€‚è™½ç„¶å¥¹å¾ˆå®³æ€•é»‘æš—çš„æ´ç©´ï¼Œä½†å¥¹æƒ³èµ·äº†å¦ˆå¦ˆæ›¾ç»è¯´è¿‡çš„è¯ï¼š"çœŸæ­£çš„å‹‡æ•¢ä¸æ˜¯ä¸å®³æ€•ï¼Œè€Œæ˜¯å³ä½¿å®³æ€•ä¹Ÿè¦å»å¸®åŠ©éœ€è¦å¸®åŠ©çš„äººã€‚"è¿™å¥è¯ç»™äº†è´è´å·¨å¤§çš„å‹‡æ°”ã€‚',
                            'è´è´æ·±æ·±å¸äº†ä¸€å£æ°”ï¼Œé¼“èµ·å‹‡æ°”å¯¹å¤§å®¶è¯´ï¼š"è®©æˆ‘è¯•è¯•å§ï¼"ç„¶åå¥¹å°å¿ƒç¿¼ç¿¼åœ°è·³è¿›äº†å±±æ´ã€‚æ´é‡Œå¾ˆé»‘å¾ˆå†·ï¼Œè´è´çš„å¿ƒæ€¦æ€¦ç›´è·³ï¼Œä½†å¥¹æƒ³ç€å¥‡å¥‡éœ€è¦å¸®åŠ©ï¼Œå°±ä¸€æ­¥ä¸€æ­¥å‹‡æ•¢åœ°å¾€ä¸‹èµ°ï¼Œç”¨å¥¹çš„å°çˆªå­æ‘¸ç´¢ç€å‰è¿›ã€‚',
                            'ç»ˆäºï¼Œè´è´åœ¨æ´åº•æ‰¾åˆ°äº†å—ä¼¤å“­æ³£çš„å¥‡å¥‡ã€‚å¥¹æ¸©æŸ”åœ°å®‰æ…°å¥‡å¥‡ï¼š"åˆ«æ€•ï¼Œæˆ‘æ¥æ•‘ä½ äº†ï¼"ç„¶åå¥¹ç”¨è‡ªå·±æŸ”è½¯çš„æ¯›å‘ä¸ºå¥‡å¥‡ä¿æš–ï¼Œå¹¶æƒ³åŠæ³•èƒŒç€ä»–æ…¢æ…¢çˆ¬å‡ºäº†å±±æ´ã€‚å½“å¤§å®¶çœ‹åˆ°è´è´å®‰å…¨åœ°æ•‘å‡ºå¥‡å¥‡æ—¶ï¼Œéƒ½ä¸ºå¥¹é¼“æŒå–å½©ã€‚',
                            'ä»é‚£å¤©èµ·ï¼Œè´è´å†ä¹Ÿä¸æ˜¯é‚£åªèƒ†å°çš„å°å…”å­äº†ã€‚å¥¹å­¦ä¼šäº†å‹‡æ•¢ï¼Œä¹Ÿæ˜ç™½äº†å¸®åŠ©åˆ«äººä¼šè®©è‡ªå·±å˜å¾—æ›´åŠ å¼ºå¤§å’Œå¿«ä¹ã€‚æ£®æ—é‡Œçš„å°åŠ¨ç‰©ä»¬éƒ½å¾ˆä½©æœè´è´ï¼Œå¥¹ä¹Ÿæˆä¸ºäº†å¤§å®¶æœ€å¥½çš„æœ‹å‹ã€‚å‹‡æ•¢çš„è´è´å‘Šè¯‰æˆ‘ä»¬ï¼šæ¯ä¸ªäººå¿ƒä¸­éƒ½æœ‰ä¸€é¢—å‹‡æ•¢çš„ç§å­ï¼Œåªè¦æˆ‘ä»¬æ„¿æ„å»å¸®åŠ©åˆ«äººï¼Œè¿™é¢—ç§å­å°±ä¼šå‘èŠ½æˆé•¿ã€‚'
                        ]
                    },
                    'ç¥å¥‡çš„æ£®æ—': {
                        title: 'ç¥å¥‡æ£®æ—çš„ç§˜å¯†',
                        paragraphs: [
                            'åœ¨é¥è¿œçš„å±±è°·æ·±å¤„ï¼Œæœ‰ä¸€ç‰‡ç¥å¥‡çš„æ£®æ—ï¼Œè¿™é‡Œçš„æ ‘æœ¨ä¼šå‘å‡ºæ¸©æš–çš„å…‰èŠ’ï¼ŒèŠ±æœµä¼šå”±å‡ºç¾å¦™çš„æ­Œå£°ï¼Œè´è¶çš„ç¿…è†€åƒå½©è™¹ä¸€æ ·ç»šçƒ‚å¤šå½©ã€‚å°å¥³å­©è‰è‰åœ¨ä¸€æ¬¡è¿·è·¯æ—¶å¶ç„¶å‘ç°äº†è¿™ä¸ªå¥‡å¦™çš„åœ°æ–¹ï¼Œå¥¹è¢«çœ¼å‰çš„ç¾æ™¯æ·±æ·±éœ‡æ’¼äº†ã€‚',
                            'è‰è‰èµ°è¿›æ£®æ—æ·±å¤„ï¼Œé‡åˆ°äº†ä¸€åªä¼šè¯´è¯çš„å°é¹¿ã€‚å°é¹¿ç”¨æ¸©æŸ”çš„å£°éŸ³å‘Šè¯‰å¥¹ï¼Œè¿™ç‰‡æ£®æ—æ­£é¢ä¸´ç€å·¨å¤§çš„å±é™©ï¼Œé‚ªæ¶çš„é»‘æš—å·«å¸ˆæƒ³è¦å¤ºèµ°æ£®æ—çš„é­”æ³•åŠ›é‡ï¼Œè®©æ‰€æœ‰ç¾å¥½çš„ä¸œè¥¿éƒ½æ¶ˆå¤±ä¸è§ï¼Œå˜æˆä¸€ç‰‡æ­»å¯‚çš„è’åœ°ã€‚',
                            'å–„è‰¯çš„è‰è‰å¬äº†éå¸¸éš¾è¿‡ï¼Œå¥¹å†³å®šå¸®åŠ©æ£®æ—åº¦è¿‡è¿™ä¸ªå±æœºã€‚å°é¹¿å¸¦å¥¹å»è§æ£®æ—é‡Œæœ€æ™ºæ…§çš„è€æ ‘çˆ·çˆ·ï¼Œè€æ ‘çˆ·çˆ·ç”¨è‹è€å´åšå®šçš„å£°éŸ³å‘Šè¯‰å¥¹ï¼Œåªæœ‰é›†é½ä¸‰é¢—ä¸åŒé¢œè‰²çš„é­”æ³•å®çŸ³ï¼Œæ‰èƒ½å½¢æˆä¿æŠ¤æ£®æ—çš„å¼ºå¤§é­”æ³•å±éšœã€‚',
                            'è‰è‰å¼€å§‹äº†å¯»æ‰¾é­”æ³•å®çŸ³çš„å†’é™©ä¹‹æ—…ã€‚å¥¹å¸®åŠ©è¿·è·¯çš„å°é¸Ÿæ‰¾åˆ°å›å®¶çš„è·¯ï¼Œå°é¸Ÿæ„ŸåŠ¨åœ°é€ç»™å¥¹ä¸€é¢—è“è‰²çš„å‹å–„å®çŸ³ï¼›å¥¹æ•‘åŠ©äº†è¢«è†æ£˜ç¼ ä½çš„å°ç‹ç‹¸ï¼Œå°ç‹ç‹¸æ„Ÿæ¿€åœ°èµ é€ç»™å¥¹ä¸€é¢—çº¢è‰²çš„çˆ±å¿ƒå®çŸ³ã€‚æ¯ä¸€æ¬¡å–„è¡Œéƒ½è®©è‰è‰çš„å¿ƒæ›´åŠ æ¸©æš–ã€‚',
                            'æœ€åä¸€é¢—ç»¿è‰²çš„å‹‡æ°”å®çŸ³è—åœ¨æœ€å±é™©çš„é»‘æš—å±±è°·é‡Œï¼Œé‚£é‡Œæœ‰å·«å¸ˆè®¾ä¸‹çš„é‡é‡æœºå…³ã€‚è‰è‰è™½ç„¶å¿ƒé‡Œå¾ˆå®³æ€•ï¼Œä½†æƒ³åˆ°æ£®æ—é‡Œæ‰€æœ‰å¯çˆ±çš„æœ‹å‹ä»¬ï¼Œå¥¹é¼“èµ·å‹‡æ°”ï¼Œå‡­å€Ÿæ™ºæ…§å’ŒåšæŒï¼Œç»ˆäºæˆåŠŸå–å¾—äº†æœ€åä¸€é¢—å®çŸ³ã€‚',
                            'å½“ä¸‰é¢—é­”æ³•å®çŸ³èšé›†åœ¨ä¸€èµ·æ—¶ï¼Œå®ƒä»¬å‘å‡ºäº†è€€çœ¼çš„å½©è‰²å…‰èŠ’ï¼Œå½¢æˆäº†ä¸€é“å¼ºå¤§çš„ä¿æŠ¤å±éšœï¼ŒæˆåŠŸé©±èµ°äº†é‚ªæ¶çš„é»‘æš—å·«å¸ˆã€‚æ£®æ—é‡æ–°æ¢å¤äº†å¾€æ—¥çš„ç¾ä¸½å’Œç”Ÿæœºï¼Œæ‰€æœ‰çš„åŠ¨ç‰©å’Œæ¤ç‰©éƒ½æ„Ÿè°¢è‰è‰çš„å‹‡æ•¢å’Œå–„è‰¯ã€‚ä»æ­¤ä»¥åï¼Œè‰è‰æˆä¸ºäº†æ£®æ—çš„å®ˆæŠ¤è€…ï¼Œå¥¹æ˜ç™½äº†å–„è‰¯å’Œå‹‡æ•¢çš„åŠ›é‡æ˜¯ä¸–ç•Œä¸Šæœ€çè´µçš„é­”æ³•ã€‚'
                        ]
                    },
                    'å‹è°Šçš„åŠ›é‡': {
                        title: 'æœ€å¥½çš„æœ‹å‹',
                        paragraphs: [
                            'åœ¨ä¸€ç‰‡ç»¿æ„ç›ç„¶çš„æ£®æ—é‡Œï¼Œå°ç†Šæ³¢æ³¢å’Œå°å…”è·³è·³æ˜¯æœ€å¥½æœ€å¥½çš„æœ‹å‹ã€‚ä»–ä»¬æ¯å¤©ä¸€èµ·åœ¨è‰åœ°ä¸Šç©è€ï¼Œä¸€èµ·åˆ†äº«ç¾å‘³çš„èœ‚èœœå’Œèƒ¡èåœï¼Œä¸€èµ·åœ¨æ ‘è«ä¸‹å¬é¸Ÿå„¿å”±æ­Œã€‚æ£®æ—é‡Œçš„å…¶ä»–å°åŠ¨ç‰©éƒ½éå¸¸ç¾¡æ…•ä»–ä»¬æ·±åšçš„å‹è°Šï¼Œè®¤ä¸ºä»–ä»¬æ˜¯ä¸–ç•Œä¸Šæœ€å¹¸ç¦çš„ä¸€å¯¹å¥½æœ‹å‹ã€‚',
                            'æœ‰ä¸€å¤©ï¼Œæ£®æ—é‡Œæ¥äº†ä¸€åªæ–°æœ‹å‹â€”â€”èªæ˜æ´»æ³¼çš„å°çŒ´å­çš®çš®ã€‚çš®çš®ä¼šå¾ˆå¤šæœ‰è¶£çš„æ¸¸æˆå’Œé­”æœ¯ï¼Œè¿˜ä¼šè®²è®¸å¤šç²¾å½©çš„å†’é™©æ•…äº‹ã€‚æ³¢æ³¢å¾ˆå¿«å°±è¢«çš®çš®çš„æ‰åå¸å¼•äº†ï¼Œå¼€å§‹èŠ±è¶Šæ¥è¶Šå¤šçš„æ—¶é—´å’Œçš®çš®ä¸€èµ·ç©è€ï¼Œå­¦ä¹ æ–°çš„æŠ€èƒ½ã€‚',
                            'è·³è·³çœ‹åˆ°æ³¢æ³¢å’Œçš®çš®ç©å¾—é‚£ä¹ˆå¼€å¿ƒï¼Œå¿ƒé‡Œå¼€å§‹æ„Ÿåˆ°å­¤å•å’Œå«‰å¦’ã€‚å¥¹è§‰å¾—æ³¢æ³¢ä¸å†åƒä»¥å‰é‚£æ ·å–œæ¬¢å’Œå¥¹åœ¨ä¸€èµ·äº†ï¼Œæ‹…å¿ƒçš®çš®ä¼šæŠ¢èµ°å¥¹æœ€å¥½çš„æœ‹å‹ã€‚äºæ˜¯è·³è·³å¼€å§‹ç–è¿œæ³¢æ³¢ï¼Œç”šè‡³å¯¹æ–°æ¥çš„çš®çš®ä¹Ÿè¡¨ç°å‡ºä¸å‹å¥½çš„æ€åº¦ï¼Œå¿ƒæƒ…å˜å¾—è¶Šæ¥è¶Šæ²®ä¸§ã€‚',
                            'æ•æ„Ÿçš„æ³¢æ³¢å¾ˆå¿«æ³¨æ„åˆ°äº†è·³è·³çš„å˜åŒ–ï¼Œä»–çš„å¿ƒé‡Œä¹Ÿå˜å¾—å¾ˆå›°æƒ‘å’Œéš¾è¿‡ã€‚ç»è¿‡æ·±æ€ç†Ÿè™‘åï¼Œæ³¢æ³¢ä¸»åŠ¨æ‰¾åˆ°äº†è·³è·³ï¼Œè¯šæ³åœ°å¯¹å¥¹è¯´ï¼š"è·³è·³ï¼Œä½ æ°¸è¿œæ˜¯æˆ‘æœ€çè´µçš„æœ‹å‹ï¼Œè¿™ä¸€ç‚¹æ°¸è¿œä¸ä¼šæ”¹å˜ã€‚æˆ‘å¸Œæœ›æˆ‘ä»¬ä¸‰ä¸ªéƒ½èƒ½æˆä¸ºå¥½æœ‹å‹ï¼Œä¸€èµ·åˆ†äº«æ›´å¤šçš„å¿«ä¹æ—¶å…‰ã€‚"',
                            'å¬äº†æ³¢æ³¢çœŸè¯šçš„è¯è¯­ï¼Œè·³è·³æ„è¯†åˆ°è‡ªå·±çš„æƒ³æ³•æ˜¯é”™è¯¯çš„ã€‚å¥¹ä¸»åŠ¨æ‰¾åˆ°çš®çš®ï¼Œä¸ºè‡ªå·±ä¹‹å‰çš„å†·æ·¡æ€åº¦é“æ­‰ï¼Œå¹¶çœŸå¿ƒé‚€è¯·çš®çš®åŠ å…¥ä»–ä»¬çš„æ¸¸æˆã€‚çš®çš®ä¹Ÿå¾ˆé«˜å…´èƒ½å¤Ÿå’Œè·³è·³æˆä¸ºæœ‹å‹ï¼Œä¸‰ä¸ªå°åŠ¨ç‰©å¾ˆå¿«å°±æˆä¸ºäº†æœ€å¥½çš„æœ‹å‹ç»„åˆã€‚',
                            'ä»é‚£ä»¥åï¼Œæ³¢æ³¢ã€è·³è·³å’Œçš®çš®æˆä¸ºäº†æ£®æ—é‡Œæœ€å¿«ä¹çš„ä¸‰äººå°å›¢ä½“ã€‚ä»–ä»¬ä¸€èµ·æ¢é™©ã€ä¸€èµ·å­¦ä¹ ã€ä¸€èµ·æˆé•¿ã€‚é€šè¿‡è¿™æ¬¡ç»å†ï¼Œä»–ä»¬éƒ½æ˜ç™½äº†ä¸€ä¸ªé‡è¦çš„é“ç†ï¼šçœŸæ­£çš„å‹è°Šä¸æ˜¯ç‹¬å å’Œæ’æ–¥ï¼Œè€Œæ˜¯åŒ…å®¹å’Œåˆ†äº«ï¼›ä¸æ˜¯å«‰å¦’å’Œç«äº‰ï¼Œè€Œæ˜¯ç†è§£å’Œæ”¯æŒã€‚å‹è°Šçš„åŠ›é‡åœ¨äºè®©æ¯ä¸ªäººéƒ½å˜å¾—æ›´å¥½ï¼Œè®©ä¸–ç•Œå˜å¾—æ›´åŠ ç¾å¥½ã€‚'
                        ]
                    },
                    'å¥‡å¦™çš„æµ·åº•ä¸–ç•Œ': {
                        title: 'å°æµ·è±šçš„å¤§å†’é™©',
                        paragraphs: [
                            'åœ¨æ·±è“æ·±è“çš„å¤§æµ·é‡Œï¼Œä½ç€ä¸€åªæ´»æ³¼å¯çˆ±çš„å°æµ·è±šæœµæœµã€‚æœµæœµæœ‰ç€é“¶ç™½è‰²çš„å…‰æ»‘çš®è‚¤å’Œäº®æ™¶æ™¶çš„å¤§çœ¼ç›ï¼Œå¥¹æœ€å–œæ¬¢å’Œæµ·æ´‹æœ‹å‹ä»¬ä¸€èµ·åœ¨çŠç‘šç¤é—´æ¸¸æ¥æ¸¸å»ï¼Œæ¢ç´¢æµ·åº•ä¸–ç•Œçš„å¥‡å¦™ç§˜å¯†ã€‚',
                            'ä¸€å¤©ï¼Œæœµæœµå¬è¯´æµ·æ´‹æ·±å¤„æœ‰ä¸€é¢—èƒ½å®ç°æ„¿æœ›çš„ç¥å¥‡çç ï¼Œä½†æ˜¯è¦æ‰¾åˆ°å®ƒéœ€è¦é€šè¿‡ä¸‰ä¸ªæŒ‘æˆ˜ã€‚å‹‡æ•¢çš„æœµæœµå†³å®šè¸ä¸Šè¿™æ®µå†’é™©æ—…ç¨‹ï¼Œå¥¹æƒ³è¦è®¸æ„¿è®©æ‰€æœ‰æµ·æ´‹ç”Ÿç‰©éƒ½èƒ½å¿«ä¹åœ°ç”Ÿæ´»åœ¨ä¸€èµ·ã€‚',
                            'ç¬¬ä¸€ä¸ªæŒ‘æˆ˜æ˜¯è¦å¸®åŠ©è¿·è·¯çš„å°é±¼ç¾¤æ‰¾åˆ°å›å®¶çš„è·¯ã€‚æœµæœµç”¨å¥¹æ•é”çš„å£°å‘å®šä½èƒ½åŠ›ï¼Œå¼•å¯¼ç€å°é±¼ä»¬ç©¿è¿‡å±é™©çš„æµ·æ²Ÿï¼Œå®‰å…¨å›åˆ°äº†å®ƒä»¬æ¸©æš–çš„å®¶ã€‚å°é±¼ä»¬æ„Ÿæ¿€åœ°é€ç»™æœµæœµä¸€ç‰‡é—ªäº®çš„é³ç‰‡ä½œä¸ºç¤¼ç‰©ã€‚',
                            'ç¬¬äºŒä¸ªæŒ‘æˆ˜æ›´åŠ å›°éš¾ï¼Œæœµæœµéœ€è¦åŠæœè„¾æ°”æš´èºçš„ç« é±¼å…ˆç”Ÿä¸è¦æ¬ºè´Ÿå…¶ä»–å°åŠ¨ç‰©ã€‚æœµæœµç”¨è€å¿ƒå’Œæ™ºæ…§ä¸ç« é±¼å…ˆç”Ÿäº¤æµï¼Œäº†è§£åˆ°ä»–å…¶å®å¾ˆå­¤ç‹¬ã€‚æœµæœµé‚€è¯·ç« é±¼å…ˆç”ŸåŠ å…¥å¥¹çš„æœ‹å‹åœˆï¼Œç« é±¼å…ˆç”Ÿä»æ­¤å˜å¾—å‹å–„èµ·æ¥ã€‚',
                            'æœ€åçš„æŒ‘æˆ˜æ˜¯è¦åœ¨é»‘æš—çš„æµ·åº•æ´ç©´ä¸­æ‰¾åˆ°ç¥å¥‡çç ã€‚æœµæœµå…‹æœäº†å¯¹é»‘æš—çš„ææƒ§ï¼Œå‡­å€Ÿç€å‹‡æ°”å’Œä¹‹å‰è·å¾—çš„å¸®åŠ©ï¼Œç»ˆäºæ‰¾åˆ°äº†é‚£é¢—å‘ç€æ¸©æŸ”å…‰èŠ’çš„çç ã€‚',
                            'å½“æœµæœµè®¸ä¸‹"è®©æ‰€æœ‰æµ·æ´‹ç”Ÿç‰©å’Œè°å…±å¤„"çš„æ„¿æœ›æ—¶ï¼Œæ•´ä¸ªæµ·æ´‹éƒ½è¢«æ¸©æš–çš„å…‰èŠ’åŒ…å›´äº†ã€‚ä»é‚£ä»¥åï¼Œæµ·åº•ä¸–ç•Œå˜å¾—æ›´åŠ ç¾ä¸½å’Œè°ï¼Œæ‰€æœ‰çš„ç”Ÿç‰©éƒ½æˆä¸ºäº†æœ‹å‹ã€‚æœµæœµä¹Ÿæ˜ç™½äº†ï¼Œæœ€ç¥å¥‡çš„é­”æ³•å…¶å®å°±æ˜¯çˆ±å¿ƒå’Œå‹å–„ã€‚'
                        ]
                    },
                    'å¤ªç©ºå¤§å†’é™©': {
                        title: 'å°æ˜Ÿæ˜Ÿçš„å®‡å®™ä¹‹æ—…',
                        paragraphs: [
                            'åœ¨é¥è¿œçš„é“¶æ²³ç³»è¾¹ç¼˜ï¼Œæœ‰ä¸€é¢—åå«é—ªé—ªçš„å°æ˜Ÿæ˜Ÿï¼Œå¥¹ä¸€ç›´æ¢¦æƒ³ç€èƒ½å¤Ÿç¯æ¸¸æ•´ä¸ªå®‡å®™ï¼Œçœ‹çœ‹å…¶ä»–æ˜Ÿçƒä¸Šçš„å¥‡å¦™æ™¯è±¡ã€‚è™½ç„¶å¥¹è¿˜å¾ˆå¹´è½»ï¼Œå…‰èŠ’ä¹Ÿä¸å¤Ÿæ˜äº®ï¼Œä½†å¥¹æœ‰ä¸€é¢—å‹‡æ•¢æ¢ç´¢çš„å¿ƒã€‚',
                            'ä¸€å¤©ï¼Œé—ªé—ªé‡åˆ°äº†ä¸€è‰˜è¿·è·¯çš„å¤ªç©ºèˆ¹ï¼Œèˆ¹ä¸Šçš„å°å®‡èˆªå‘˜é˜¿å¼ºæ­£åœ¨å¯»æ‰¾å›åœ°çƒçš„è·¯ã€‚é—ªé—ªå†³å®šå¸®åŠ©é˜¿å¼ºï¼Œä»–ä»¬ä¸€èµ·è¸ä¸Šäº†ç©¿è¶Šå®‡å®™çš„å¥‡å¦™æ—…ç¨‹ï¼Œè§è¯äº†è®¸å¤šä»æœªè§è¿‡çš„ç¾ä¸½æ™¯è±¡ã€‚',
                            'åœ¨æ—…é€”ä¸­ï¼Œä»–ä»¬ç»è¿‡äº†å½©è™¹æ˜Ÿçƒï¼Œé‚£é‡Œçš„ä¸€åˆ‡éƒ½æ˜¯äº”é¢œå…­è‰²çš„ï¼›é£è¿‡äº†éŸ³ä¹æ˜Ÿçƒï¼Œæ•´ä¸ªæ˜Ÿçƒéƒ½åœ¨æ¼”å¥ç€ç¾å¦™çš„äº¤å“ä¹ï¼›è¿˜æ‹œè®¿äº†ç³–æœæ˜Ÿçƒï¼Œé‚£é‡Œçš„å±±è„‰éƒ½æ˜¯ç”¨å·§å…‹åŠ›åšæˆçš„ï¼Œæ²³æµéƒ½æ˜¯ç”œç”œçš„æœæ±ã€‚',
                            'ä½†æ˜¯æ—…é€”å¹¶ä¸æ€»æ˜¯é¡ºåˆ©çš„ï¼Œä»–ä»¬é‡åˆ°äº†å¤ªç©ºé£æš´ï¼Œè¿˜å·®ç‚¹è¢«é»‘æ´å¸èµ°ã€‚å…³é”®æ—¶åˆ»ï¼Œé—ªé—ªå‘ç°äº†è‡ªå·±å†…å¿ƒæ·±å¤„çš„å…‰èŠ’ï¼Œå¥¹åŠªåŠ›è®©è‡ªå·±å‘å…‰å‘çƒ­ï¼Œä¸ºé˜¿å¼ºæŒ‡å¼•äº†æ­£ç¡®çš„æ–¹å‘ã€‚',
                            'ç»è¿‡è®¸å¤šå†’é™©ï¼Œé—ªé—ªå’Œé˜¿å¼ºç»ˆäºæ‰¾åˆ°äº†å›åœ°çƒçš„è·¯ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œé—ªé—ªä¸ä»…å¸®åŠ©äº†æœ‹å‹ï¼Œä¹Ÿå‘ç°äº†è‡ªå·±çš„ä»·å€¼å’ŒåŠ›é‡ã€‚å¥¹æ˜ç™½äº†ï¼Œæ¯é¢—æ˜Ÿæ˜Ÿéƒ½æœ‰è‡ªå·±ç‹¬ç‰¹çš„å…‰èŠ’å’Œä½¿å‘½ã€‚',
                            'å½“é˜¿å¼ºå®‰å…¨å›åˆ°åœ°çƒæ—¶ï¼Œä»–å‘æ‰€æœ‰äººè®²è¿°äº†å°æ˜Ÿæ˜Ÿé—ªé—ªçš„å‹‡æ•¢æ•…äº‹ã€‚ä»é‚£ä»¥åï¼Œé—ªé—ªæˆä¸ºäº†å®‡å®™ä¸­æœ€å—å°Šæ•¬çš„å¯¼èˆªæ˜Ÿï¼Œç”¨è‡ªå·±çš„å…‰èŠ’ä¸ºæ‰€æœ‰è¿·è·¯çš„æ—…è¡Œè€…æŒ‡å¼•å›å®¶çš„æ–¹å‘ã€‚'
                        ]
                    },
                    'å–„è‰¯çš„å°å…¬ä¸»': {
                        title: 'ç«ç‘°å…¬ä¸»çš„é­”æ³•èŠ±å›­',
                        paragraphs: [
                            'åœ¨ä¸€ä¸ªç¾ä¸½çš„ç‹å›½é‡Œï¼Œä½ç€ä¸€ä½å¿ƒåœ°å–„è‰¯çš„å°å…¬ä¸»ï¼Œå¤§å®¶éƒ½å«å¥¹ç«ç‘°å…¬ä¸»ã€‚å¥¹æœ‰ç€é‡‘è‰²çš„å·å‘å’Œæ¸©æš–çš„ç¬‘å®¹ï¼Œä½†æœ€ç‰¹åˆ«çš„æ˜¯å¥¹æ‹¥æœ‰ä¸€åº§ç¥å¥‡çš„èŠ±å›­ï¼Œé‚£é‡Œç§ç€ä¸–ç•Œä¸Šæœ€ç¾çš„èŠ±æœµã€‚',
                            'ç«ç‘°å…¬ä¸»çš„èŠ±å›­æœ‰ä¸€ä¸ªç§˜å¯†ï¼šåªè¦å…¬ä¸»å¯¹èŠ±æœµä»¬è¯´å‡ºå–„è‰¯çš„è¯è¯­ï¼ŒèŠ±æœµä»¬å°±ä¼šç»½æ”¾å¾—æ›´åŠ ç¾ä¸½ï¼Œæ•£å‘å‡ºæ²»æ„ˆäººå¿ƒçš„é¦™æ°”ã€‚å…¬ä¸»æ¯å¤©éƒ½ä¼šåœ¨èŠ±å›­é‡Œå’ŒèŠ±æœµä»¬èŠå¤©ï¼Œå‘Šè¯‰å®ƒä»¬å…³äºå–„è‰¯å’Œçˆ±çš„æ•…äº‹ã€‚',
                            'æœ‰ä¸€å¤©ï¼Œé‚»å›½æ¥äº†ä¸€ä½ç”Ÿç—…çš„å°ç‹å­ï¼Œä»»ä½•è¯ç‰©éƒ½æ— æ³•æ²»æ„ˆä»–çš„ç–¾ç—…ï¼Œä»–å˜å¾—è¶Šæ¥è¶Šè™šå¼±ã€‚ç«ç‘°å…¬ä¸»å¬è¯´åï¼Œå†³å®šç”¨è‡ªå·±èŠ±å›­é‡Œçš„é­”æ³•èŠ±æœµæ¥å¸®åŠ©å°ç‹å­æ¢å¤å¥åº·ã€‚',
                            'å…¬ä¸»ç²¾å¿ƒæŒ‘é€‰äº†æœ€ç¾ä¸½çš„ç«ç‘°èŠ±ï¼Œç”¨å®ƒä»¬åˆ¶ä½œäº†ä¸€ç“¶å……æ»¡çˆ±å¿ƒçš„èŠ±éœ²ã€‚å½“å°ç‹å­é—»åˆ°è¿™ç¥å¥‡èŠ±éœ²çš„é¦™æ°”æ—¶ï¼Œä»–è‹ç™½çš„è„¸é¢Šå¼€å§‹æ³›èµ·çº¢æ™•ï¼Œèº«ä½“ä¹Ÿæ¸æ¸æ¢å¤äº†åŠ›é‡ã€‚',
                            'å°ç‹å­åº·å¤åï¼Œä»–é—®å…¬ä¸»èŠ±æœµä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·ç¥å¥‡çš„é­”æ³•ã€‚ç«ç‘°å…¬ä¸»æ¸©æŸ”åœ°å‘Šè¯‰ä»–ï¼š"çœŸæ­£çš„é­”æ³•ä¸åœ¨äºèŠ±æœµï¼Œè€Œåœ¨äºæˆ‘ä»¬å¿ƒä¸­çš„å–„è‰¯å’Œçˆ±ã€‚å½“æˆ‘ä»¬çœŸå¿ƒå…³æ€€åˆ«äººæ—¶ï¼Œå°±èƒ½åˆ›é€ å‡ºæœ€ç¾å¥½çš„å¥‡è¿¹ã€‚"',
                            'ä»é‚£ä»¥åï¼Œä¸¤ä¸ªç‹å›½æˆä¸ºäº†æœ€å¥½çš„æœ‹å‹ï¼Œå°ç‹å­ä¹Ÿå­¦ä¼šäº†åƒç«ç‘°å…¬ä¸»ä¸€æ ·ç”¨å–„è‰¯çš„å¿ƒå¯¹å¾…æ¯ä¸€ä¸ªäººã€‚ç«ç‘°å…¬ä¸»çš„èŠ±å›­å˜å¾—æ›´åŠ ç¹ç››ï¼Œå› ä¸ºçˆ±å’Œå–„è‰¯çš„ç§å­å·²ç»åœ¨æ¯ä¸ªäººå¿ƒä¸­ç”Ÿæ ¹å‘èŠ½ã€‚'
                        ]
                    }
                };

                // è·å–åŒ¹é…çš„æ•…äº‹æˆ–ç”Ÿæˆè‡ªå®šä¹‰æ•…äº‹
                let story = storyTemplates[theme] || this.generateCustomStory(theme);
                
                // æ¨¡æ‹ŸAIç”Ÿæˆçš„å»¶è¿Ÿ
                await this.delay(2000 + Math.random() * 1000);
                
                return story;
            }

            generateCustomStory(theme) {
                const titles = [
                    `${theme}çš„å¥‡å¦™å†’é™©`,
                    `å…³äº${theme}çš„æ¸©æš–æ•…äº‹`,
                    `${theme}ä¸é­”æ³•ä¸–ç•Œ`,
                    `å‹‡æ•¢çš„${theme}æˆé•¿è®°`,
                    `${theme}çš„å‹è°Šä¹‹æ—…`,
                    `å–„è‰¯${theme}çš„ç¾å¥½æ„¿æœ›`
                ];

                const paragraphs = [
                    `ä»å‰ï¼Œåœ¨ä¸€ä¸ªå……æ»¡å¥‡è¿¹çš„åœ°æ–¹ï¼Œæœ‰ä¸€ä¸ªå…³äº${theme}çš„åŠ¨äººæ•…äº‹ã€‚æ•…äº‹çš„ä¸»äººå…¬æ˜¯ä¸€ä¸ªå–„è‰¯å‹‡æ•¢çš„å°æœ‹å‹ï¼Œä»–å³å°†å¼€å§‹ä¸€æ®µæ”¹å˜äººç”Ÿçš„å¥‡å¦™æ—…ç¨‹ï¼Œå»å‘ç°${theme}çš„çœŸæ­£æ„ä¹‰ã€‚`,
                    
                    `è¿™ä¸ªå°æœ‹å‹å¯¹${theme}å……æ»¡äº†å¥½å¥‡å¿ƒå’Œå‘å¾€ã€‚æœ‰ä¸€å¤©ï¼Œä»–ä¸‹å®šå†³å¿ƒè¦èµ°å‡ºèˆ’é€‚çš„å®¶ï¼Œå»æ¢ç´¢è¿™ä¸ªå……æ»¡æ— é™å¯èƒ½çš„å¹¿é˜”ä¸–ç•Œï¼Œå¯»æ‰¾å±äºè‡ªå·±çš„ç­”æ¡ˆå’Œæ¢¦æƒ³ã€‚æ¯ä¸€æ­¥éƒ½å……æ»¡äº†æ–°çš„å‘ç°å’ŒæƒŠå–œã€‚`,
                    
                    `åœ¨å……æ»¡æŒ‘æˆ˜çš„æ—…é€”ä¸­ï¼Œå°æœ‹å‹é‡åˆ°äº†å„ç§å„æ ·æœ‰è¶£çš„æœ‹å‹å’Œæ„æƒ³ä¸åˆ°çš„å›°éš¾ã€‚æ¯ä¸€æ¬¡ç»å†éƒ½åƒä¸€å ‚çè´µçš„äººç”Ÿè¯¾ç¨‹ï¼Œè®©ä»–å­¦åˆ°äº†æ–°çš„çŸ¥è¯†ï¼Œä¹Ÿè®©ä»–çš„å¿ƒçµå˜å¾—æ›´åŠ å‹‡æ•¢ã€æ™ºæ…§å’Œå®½å®¹ã€‚`,
                    
                    `é€šè¿‡ä¸${theme}ç›¸å…³çš„ç§ç§ç²¾å½©å†’é™©å’Œæ„Ÿäººç»å†ï¼Œå°æœ‹å‹ä¸ä»…å¸®åŠ©äº†è®¸å¤šéœ€è¦å¸®åŠ©çš„äººï¼Œè§£å†³äº†ä»–ä»¬çš„å›°éš¾ï¼Œä¹Ÿåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å‘ç°äº†è‡ªå·±å†…å¿ƒæ·±å¤„éšè—çš„å·¨å¤§åŠ›é‡å’Œæ— é™ä»·å€¼ã€‚`,
                    
                    `åœ¨ç»å†äº†é‡é‡è€ƒéªŒå’Œæˆé•¿åï¼Œå°æœ‹å‹ç»ˆäºæ·±åˆ»ç†è§£äº†${theme}çš„çœŸæ­£å«ä¹‰å’Œçè´µä»·å€¼ã€‚ä»–å¸¦ç€æ»¡å¿ƒçš„æ”¶è·ã€ç¾å¥½çš„å›å¿†å’Œæ–°ç»“è¯†çš„æœ‹å‹ä»¬å›åˆ°äº†å®¶ï¼Œä½†ä»–çš„å¿ƒå¢ƒå·²ç»å˜å¾—æ›´åŠ å®½å¹¿ã€æ¸©æš–å’Œå……æ»¡å¸Œæœ›ã€‚`,
                    
                    `è¿™ä¸ªå…³äº${theme}çš„ç¾ä¸½æ•…äº‹å‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ªæ°¸æ’çš„é“ç†ï¼šæ¯ä¸ªäººéƒ½æ‹¥æœ‰è‡ªå·±ç‹¬ç‰¹è€Œçè´µçš„ä»·å€¼ï¼Œåªè¦æˆ‘ä»¬ä¿æŒå–„è‰¯çº¯çœŸçš„å¿ƒå’Œå‹‡æ•¢åšæŒçš„ç²¾ç¥ï¼Œå°±ä¸€å®šèƒ½å¤Ÿåˆ›é€ å±äºè‡ªå·±çš„ç²¾å½©äººç”Ÿï¼Œè®©ä¸–ç•Œå› ä¸ºæˆ‘ä»¬çš„å­˜åœ¨è€Œå˜å¾—æ›´åŠ ç¾å¥½ã€‚`
                ];

                return {
                    title: titles[Math.floor(Math.random() * titles.length)],
                    paragraphs
                };
            }

            async generateImages(story) {
                if (!story) return;
                
                story.images = [];
                
                // é«˜è´¨é‡å›¾ç‰‡åº“ï¼Œæ ¹æ®å†…å®¹åŒ¹é…
                const imageLibrary = {
                    // åŠ¨ç‰©ç›¸å…³
                    'å…”å­': [
                        'https://images.unsplash.com/photo-1585110396000-c9ffd4e4b308?w=400&h=300&fit=crop&q=80',
                        'https://images.unsplash.com/photo-1425082661705-1834bfd09dca?w=400&h=300&fit=crop&q=80'
                    ],
                    'æ£®æ—': [
                        'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400&h=300&fit=crop&q=80',
                        'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=300&fit=crop&q=80'
                    ],
                    'å‹è°Š': [
                        'https://images.unsplash.com/photo-1529903475582-154eb4c7ee9a?w=400&h=300&fit=crop&q=80',
                        'https://images.unsplash.com/photo-1523800503107-5bc3ba2a6f81?w=400&h=300&fit=crop&q=80'
                    ],
                    'æµ·åº•': [
                        'https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=400&h=300&fit=crop&q=80',
                        'https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=400&h=300&fit=crop&q=80'
                    ],
                    'å¤ªç©º': [
                        'https://images.unsplash.com/photo-1446776653964-20c1d3a81b06?w=400&h=300&fit=crop&q=80',
                        'https://images.unsplash.com/photo-1462331940025-496dfbfc7564?w=400&h=300&fit=crop&q=80'
                    ],
                    'å…¬ä¸»': [
                        'https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=400&h=300&fit=crop&q=80',
                        'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=300&fit=crop&q=80'
                    ],
                    'èŠ±å›­': [
                        'https://images.unsplash.com/photo-1492571350019-22de08371fd3?w=400&h=300&fit=crop&q=80',
                        'https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=400&h=300&fit=crop&q=80'
                    ],
                    'å†’é™©': [
                        'https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400&h=300&fit=crop&q=80',
                        'https://images.unsplash.com/photo-1506197603052-3cc9c3a201bd?w=400&h=300&fit=crop&q=80'
                    ]
                };

                // é»˜è®¤å›¾ç‰‡
                const defaultImages = [
                    'https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=300&fit=crop&q=80',
                    'https://images.unsplash.com/photo-1529655683826-aba9b3e77383?w=400&h=300&fit=crop&q=80',
                    'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=300&fit=crop&q=80',
                    'https://images.unsplash.com/photo-1518709268805-4e9042af2176?w=400&h=300&fit=crop&q=80',
                    'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=400&h=300&fit=crop&q=80',
                    'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=300&fit=crop&q=80'
                ];

                for (let i = 0; i < story.paragraphs.length; i++) {
                    let selectedImages = defaultImages;
                    
                    // æ ¹æ®æ®µè½å†…å®¹å’Œæ•…äº‹æ ‡é¢˜é€‰æ‹©åˆé€‚çš„å›¾ç‰‡
                    const content = (story.paragraphs[i] + ' ' + story.title).toLowerCase();
                    
                    for (const [keyword, images] of Object.entries(imageLibrary)) {
                        if (content.includes(keyword) || content.includes(keyword.toLowerCase())) {
                            selectedImages = images;
                            break;
                        }
                    }
                    
                    // é€‰æ‹©å›¾ç‰‡å¹¶æ·»åŠ åˆ°æ•…äº‹ä¸­
                    const imageIndex = i % selectedImages.length;
                    story.images.push(selectedImages[imageIndex]);
                    
                    await this.delay(200 + Math.random() * 300); // æ¨¡æ‹Ÿç”Ÿæˆå»¶è¿Ÿ
                }

                console.log('ğŸ¨ æ•…äº‹æ’ç”»ç”Ÿæˆå®Œæˆï¼Œå…±', story.images.length, 'å¼ ');
            }

            animateLoadingSteps() {
                const steps = ['step1', 'step2', 'step3'];
                let currentStep = 0;

                this.loadingInterval = setInterval(() => {
                    if (currentStep < steps.length) {
                        const stepElement = document.getElementById(steps[currentStep]);
                        if (stepElement) {
                            stepElement.classList.add('active');
                        }
                        currentStep++;
                    } else {
                        clearInterval(this.loadingInterval);
                        this.loadingInterval = null;
                    }
                }, 800);
            }

            showStoryPage() {
                this.showPage('storyPage');
                this.updateStoryDisplay();
            }

            updateStoryDisplay() {
                if (!this.currentStory) return;

                const storyTitle = document.getElementById('storyTitle');
                const currentPage = document.getElementById('currentPage');
                const totalPages = document.getElementById('totalPages');
                const storyParagraph = document.getElementById('storyParagraph');

                if (storyTitle) storyTitle.textContent = this.currentStory.title;
                if (currentPage) currentPage.textContent = this.currentPageIndex + 1;
                if (totalPages) totalPages.textContent = this.currentStory.paragraphs.length;
                if (storyParagraph) storyParagraph.textContent = this.currentStory.paragraphs[this.currentPageIndex];
                
                // æ›´æ–°å›¾ç‰‡
                this.updateStoryImage();
                
                // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                
                if (prevBtn) prevBtn.disabled = this.currentPageIndex === 0;
                if (nextBtn) {
                    nextBtn.textContent = this.currentPageIndex === this.currentStory.paragraphs.length - 1 ? 'ç»“æŸ â†’' : 'ä¸‹ä¸€é¡µ â†’';
                }
                
                // åœæ­¢å½“å‰æ’­æ”¾
                this.stopPlayback();
            }

            updateStoryImage() {
                const img = document.getElementById('storyImg');
                const loading = document.getElementById('imageLoading');
                
                if (!img || !loading || !this.currentStory?.images) return;
                
                const imageUrl = this.currentStory.images[this.currentPageIndex];
                if (imageUrl) {
                    loading.style.display = 'flex';
                    img.style.display = 'none';
                    
                    img.onload = () => {
                        loading.style.display = 'none';
                        img.style.display = 'block';
                    };
                    
                    img.onerror = () => {
                        loading.style.display = 'none';
                        img.style.display = 'block';
                        // ä½¿ç”¨é»˜è®¤å ä½å›¾ç‰‡
                        img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgdmlld0JveD0iMCAwIDQwMCAzMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjQwMCIgaGVpZ2h0PSIzMDAiIGZpbGw9IiNGNUY1RjUiLz48cGF0aCBkPSJNMTc1IDEyNUwyMjUgMTc1TDI3NSAxMjVIMzI1TDI3NSA3NUwyMjUgMTI1TDE3NSA3NUgxMjVMMTc1IDEyNVoiIGZpbGw9IiNEMUQxRDEiLz48L3N2Zz4=';
                    };
                    
                    img.src = imageUrl;
                    img.alt = `æ•…äº‹æ’ç”» - ç¬¬${this.currentPageIndex + 1}é¡µ`;
                }
            }

            previousPage() {
                if (this.currentPageIndex > 0) {
                    this.currentPageIndex--;
                    this.updateStoryDisplay();
                    this.showToast(`ğŸ“– ç¬¬ ${this.currentPageIndex + 1} é¡µ`);
                }
            }

            nextPage() {
                if (this.currentPageIndex < this.currentStory.paragraphs.length - 1) {
                    this.currentPageIndex++;
                    this.updateStoryDisplay();
                    this.showToast(`ğŸ“– ç¬¬ ${this.currentPageIndex + 1} é¡µ`);
                } else {
                    // åˆ°è¾¾æœ€åä¸€é¡µï¼Œæ˜¾ç¤ºç»“æŸé¡µé¢
                    this.showPage('endPage');
                    this.showToast('ğŸ‰ æ•…äº‹è¯»å®Œäº†ï¼å¸Œæœ›ä½ å–œæ¬¢');
                }
            }

            togglePlayback() {
                if (this.isPlaying) {
                    this.stopPlayback();
                } else {
                    this.startPlayback();
                }
            }

            startPlayback() {
                if (!this.currentStory || !this.speechSynthesis) {
                    this.showToast('âŒ è¯­éŸ³åŠŸèƒ½æš‚ä¸å¯ç”¨');
                    return;
                }

                const text = this.currentStory.paragraphs[this.currentPageIndex];
                const speedSelect = document.getElementById('speedSelect');
                const speed = speedSelect ? parseFloat(speedSelect.value) : 1.0;

                this.currentUtterance = new SpeechSynthesisUtterance(text);
                this.currentUtterance.rate = speed;
                this.currentUtterance.pitch = 1.1;
                this.currentUtterance.volume = 1;

                // è®¾ç½®ä¸­æ–‡è¯­éŸ³
                const voices = this.speechSynthesis.getVoices();
                const chineseVoice = voices.find(voice => 
                    voice.lang.includes('zh') || 
                    voice.lang.includes('CN') ||
                    voice.name.includes('Chinese')
                );
                if (chineseVoice) {
                    this.currentUtterance.voice = chineseVoice;
                }

                this.currentUtterance.onstart = () => {
                    this.isPlaying = true;
                    this.updatePlayButton();
                    this.startTextHighlight(text);
                    console.log('ğŸµ å¼€å§‹è¯­éŸ³æœ—è¯»');
                };

                this.currentUtterance.onend = () => {
                    this.isPlaying = false;
                    this.updatePlayButton();
                    this.clearTextHighlight();
                    console.log('â¹ï¸ è¯­éŸ³æœ—è¯»ç»“æŸ');
                };

                this.currentUtterance.onerror = (error) => {
                    this.isPlaying = false;
                    this.updatePlayButton();
                    this.showToast('ğŸ˜” è¯­éŸ³æ’­æ”¾å‡ºé”™ï¼Œè¯·é‡è¯•');
                    console.error('âŒ TTSé”™è¯¯:', error);
                };

                try {
                    this.speechSynthesis.speak(this.currentUtterance);
                    this.showToast('ğŸµ å¼€å§‹æœ—è¯»æ•…äº‹');
                } catch (error) {
                    console.error('âŒ è¯­éŸ³æ’­æ”¾å¤±è´¥:', error);
                    this.showToast('âŒ è¯­éŸ³åŠŸèƒ½æš‚ä¸å¯ç”¨');
                }
            }

            stopPlayback() {
                if (this.speechSynthesis) {
                    this.speechSynthesis.cancel();
                }
                this.isPlaying = false;
                this.updatePlayButton();
                this.clearTextHighlight();
            }

            updatePlayButton() {
                const playBtn = document.getElementById('playBtn');
                if (playBtn) {
                    playBtn.textContent = this.isPlaying ? 'â¸ï¸' : 'â–¶ï¸';
                    playBtn.title = this.isPlaying ? 'æš‚åœæœ—è¯»' : 'æ’­æ”¾æœ—è¯»';
                }
            }

            startTextHighlight(text) {
                this.clearTextHighlight();
                
                const paragraph = document.getElementById('storyParagraph');
                if (!paragraph || !text) return;

                const chars = text.split('');
                let currentIndex = 0;
                
                const highlightInterval = setInterval(() => {
                    if (currentIndex < chars.length && this.isPlaying) {
                        this.highlightCharacter(paragraph, currentIndex, text);
                        currentIndex++;
                    } else {
                        clearInterval(highlightInterval);
                    }
                }, 120); // è°ƒæ•´é«˜äº®é€Ÿåº¦
                
                this.highlightTimeout = highlightInterval;
            }

            highlightCharacter(paragraph, index, originalText) {
                if (!paragraph || !originalText) return;

                const beforeText = originalText.substring(0, index);
                const currentChar = originalText.charAt(index);
                const afterText = originalText.substring(index + 1);
                
                paragraph.innerHTML = beforeText + 
                                     `<span class="highlight">${currentChar}</span>` + 
                                     afterText;
            }

            clearTextHighlight() {
                if (this.highlightTimeout) {
                    clearInterval(this.highlightTimeout);
                    this.highlightTimeout = null;
                }
                
                const paragraph = document.getElementById('storyParagraph');
                if (paragraph && this.currentStory) {
                    paragraph.textContent = this.currentStory.paragraphs[this.currentPageIndex] || '';
                }
            }

            saveStory() {
                if (!this.currentStory) {
                    this.showToast('âŒ æ²¡æœ‰æ•…äº‹å¯ä»¥ä¿å­˜');
                    return;
                }
                
                try {
                    const savedStories = JSON.parse(localStorage.getItem('savedStories') || '[]');
                    const storyToSave = {
                        ...this.currentStory,
                        savedAt: new Date().toISOString(),
                        id: Date.now()
                    };
                    
                    savedStories.push(storyToSave);
                    localStorage.setItem('savedStories', JSON.stringify(savedStories));
                    
                    this.showToast('ğŸ’¾ æ•…äº‹å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼');
                    console.log('ğŸ’¾ æ•…äº‹ä¿å­˜æˆåŠŸ:', storyToSave.title);
                } catch (error) {
                    console.error('âŒ ä¿å­˜æ•…äº‹å¤±è´¥:', error);
                    this.showToast('ğŸ˜” ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®');
                }
            }

            shareStory() {
                if (!this.currentStory) {
                    this.showToast('âŒ æ²¡æœ‰æ•…äº‹å¯ä»¥åˆ†äº«');
                    return;
                }
                
                const shareText = `æˆ‘åœ¨AIç»˜æœ¬åˆ›å»ºäº†ä¸€ä¸ªç²¾å½©çš„æ•…äº‹ï¼šã€Š${this.currentStory.title}ã€‹\n\nè¿™æ˜¯ä¸€ä¸ªä¸“ä¸ºå­©å­è®¾è®¡çš„AIç»˜æœ¬åˆ›ä½œå·¥å…·ï¼Œæ”¯æŒæ•…äº‹ç”Ÿæˆã€æ’ç”»é…å›¾å’Œè¯­éŸ³æœ—è¯»ã€‚å¿«æ¥ä¸€èµ·åˆ›ä½œå±äºä½ çš„æ•…äº‹å§ï¼\n\nâœ¨ ç‰¹è‰²åŠŸèƒ½ï¼š\nğŸ¨ AIæ™ºèƒ½æ•…äº‹ç”Ÿæˆ\nğŸ–¼ï¸ ç²¾ç¾æ’ç”»é…å›¾\nğŸµ è¯­éŸ³æœ—è¯»è·Ÿè¯»\nğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ–è®¾è®¡`;
                
                if (navigator.share) {
                    navigator.share({
                        title: `AIç»˜æœ¬ - ${this.currentStory.title}`,
                        text: shareText,
                        url: window.location.href
                    }).then(() => {
                        this.showToast('ğŸ“¤ åˆ†äº«æˆåŠŸï¼');
                    }).catch((error) => {
                        console.log('åˆ†äº«å–æ¶ˆæˆ–å¤±è´¥:', error);
                        this.fallbackShare(shareText);
                    });
                } else {
                    this.fallbackShare(shareText);
                }
            }

            fallbackShare(text) {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(text).then(() => {
                        this.showToast('ğŸ“‹ åˆ†äº«æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    }).catch(() => {
                        this.showManualShare(text);
                    });
                } else {
                    this.showManualShare(text);
                }
            }

            showManualShare(text) {
                // åˆ›å»ºä¸´æ—¶æ–‡æœ¬åŒºåŸŸç”¨äºå¤åˆ¶
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                
                try {
                    document.execCommand('copy');
                    this.showToast('ğŸ“‹ åˆ†äº«æ–‡æ¡ˆå·²å¤åˆ¶ï¼');
                } catch (err) {
                    this.showToast('ğŸ’¡ è¯·æ‰‹åŠ¨å¤åˆ¶åˆ†äº«æ–‡æ¡ˆ');
                    console.log('åˆ†äº«å†…å®¹:', text);
                }
                
                document.body.removeChild(textArea);
            }

            goHome() {
                this.stopPlayback();
                this.currentStory = null;
                this.currentPageIndex = 0;
                
                const storyInput = document.getElementById('storyInput');
                if (storyInput) {
                    storyInput.value = '';
                    storyInput.focus();
                }
                
                this.showPage('homePage');
                this.showToast('ğŸ  æ¬¢è¿å›åˆ°é¦–é¡µï¼Œå¼€å§‹æ–°çš„æ•…äº‹åˆ›ä½œå§ï¼');
            }

            showPage(pageId) {
                // æ¸…ç†åŠ è½½åŠ¨ç”»
                if (this.loadingInterval) {
                    clearInterval(this.loadingInterval);
                    this.loadingInterval = null;
                }

                // é‡ç½®æ‰€æœ‰æ­¥éª¤çŠ¶æ€
                document.querySelectorAll('.step').forEach(step => {
                    step.classList.remove('active');
                });

                // åˆ‡æ¢é¡µé¢
                document.querySelectorAll('.page').forEach(page => {
                    page.style.display = 'none';
                });
                
                const targetPage = document.getElementById(pageId);
                if (targetPage) {
                    targetPage.style.display = 'flex';
                    console.log('ğŸ“„ åˆ‡æ¢åˆ°é¡µé¢:', pageId);
                }
            }

            showToast(message, duration = 3000) {
                console.log('ğŸ“¢', message);
                const toast = document.getElementById('toast');
                if (!toast) return;

                toast.textContent = message;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, duration);
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            // æ¸…ç†æ–¹æ³•
            destroy() {
                this.stopPlayback();
                if (this.loadingInterval) {
                    clearInterval(this.loadingInterval);
                }
                if (this.highlightTimeout) {
                    clearInterval(this.highlightTimeout);
                }
            }
        }

        // åº”ç”¨åˆå§‹åŒ–
        let storyApp = null;

        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ¯ DOMå†…å®¹åŠ è½½å®Œæˆ');
            storyApp = new StoryApp();
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†èµ„æº
        window.addEventListener('beforeunload', () => {
            if (storyApp) {
                storyApp.destroy();
            }
        });

        // é˜²æ­¢é¡µé¢ç¼©æ”¾å’ŒåŒå‡»
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length > 1) {
                event.preventDefault();
            }
        }, { passive: false });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = new Date().getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, { passive: false });

        // ç¦ç”¨å³é”®èœå•
        document.addEventListener('contextmenu', function(event) {
            event.preventDefault();
        });

        // PWA å®‰è£…æç¤º
        let deferredPrompt = null;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('ğŸ’¡ PWAå®‰è£…æç¤ºå·²å‡†å¤‡');
        });

        // é”™è¯¯å¤„ç†
        window.addEventListener('error', (error) => {
            console.error('ğŸš¨ å…¨å±€é”™è¯¯:', error);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('ğŸš¨ æœªå¤„ç†çš„Promiseé”™è¯¯:', event.reason);
        });

        console.log('ğŸ‰ AIç»˜æœ¬åº”ç”¨è„šæœ¬åŠ è½½å®Œæˆ');
    </script>
</body>
</html>